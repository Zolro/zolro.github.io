I"ÿ‡<blockquote>

  <p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•æˆ‘å¦‚æœè§£å†³äº†è¿™ä¸ªå‘å¸ƒé—®é¢˜, å…·ä½“çš„è§£å†³æ–¹æ¡ˆæ–‡ä»¶å’Œæ•™ç¨‹æˆ‘å·²ç»ä¸Šä¼ è‡³ Github
<a href="https://github.com/liungkejin/GradlePublish">https://github.com/liungkejin/GradlePublish</a></p>

</blockquote>

<p>ä¹‹å‰çš„æ–‡ç«  <a href="https://liungkejin.github.io/2016/03/27/Publish-AAR-jcenter.html">Android Studio å‘å¸ƒé¡¹ç›®åˆ°Maven/JCenterä»“åº“</a>,
å°† Java åº“å‘å¸ƒåˆ° Maven/JCenter ä¸Š.</p>

<p>ä½†æ˜¯ä»Šå¤©æˆ‘æ‰“ç®—å°†æˆ‘çš„ Kotlin åº“å‘å¸ƒä¸Šå»çš„æ—¶å€™, å‘ç°äº†ä¸€äº›é—®é¢˜. å› ä¸º Kotlin æ–‡ä»¶ä¸èƒ½ç”¨ javadocå·¥å…·æ¥ç”Ÿæˆ Javadoc,
å¯¼è‡´äº†åœ¨æ‰§è¡Œ <code class="highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>bintrayUpload
</pre></td></tr></tbody></table></code> ä»»åŠ¡çš„æ—¶å€™ <code class="highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>javadocJar
</pre></td></tr></tbody></table></code> <code class="highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>sourcesJar
</pre></td></tr></tbody></table></code> ä¸¤ä¸ªä»»åŠ¡éƒ½ä¸èƒ½ build æˆåŠŸ,
è™½ç„¶æˆ‘å¯ä»¥æŠŠè¿™ä¸¤ä¸ªä»»åŠ¡å»æ‰ï¼Œ æ²¡æœ‰ *-sources.jar å’Œ *-javadoc.jar ä¸€æ ·ä¹Ÿæ˜¯å¯ä»¥å‘å¸ƒåˆ° Maven ä¸Šçš„,
ä½†æ˜¯å¦‚æœè¦å‘å¸ƒåˆ° JCenter ä¸Šå°±éœ€è¦è¿™ä¸¤ä¸ªæ–‡ä»¶äº†ï¼Œå¦‚æœæ²¡æœ‰åˆ™å®¡æ ¸è¿‡ä¸äº†</p>

<blockquote>
  <p>JCenter hosts Java applications that follow the Maven convention.
In addition to the existing files, you will need a *-sources.jar, and optionally a *-javadoc.jar. Your files should be under a Maven path layout.
(see <a href="">https://bintray.com/docs/usermanual/uploads/uploads_includingyourpackagesinjcenter.html</a>)</p>

  <p>Once those files are added, we will be glad to include your package in JCenter.</p>
</blockquote>

<p>ç„¶åæˆ‘åœ¨ Kotlin ç¤¾åŒºæ‰¾äº†ä¸€ä¸‹å…³äºç”Ÿæˆ Javadoc çš„è®¨è®ºï¼Œæœ€åå‘ç° Kotlin çš„ KDoc é¡¹ç›®å·²ç»æ²¡æœ‰äº†,
ä½†æ˜¯ Kotlin å¼€å‘äº† <a href="https://github.com/Kotlin/dokka">Dokka</a> , Dokka æ˜¯ kotlin çš„ä¸€ä¸ªæ–‡æ¡£ç”Ÿæˆå¼•æ“.</p>

<blockquote>
  <p>Dokka is a documentation engine for Kotlin, performing the same function as javadoc for Java. Just like Kotlin itself, Dokka fully supports mixed-language Java/Kotlin projects. It understands standard Javadoc comments in Java files and KDoc comments in Kotlin files, and can generate documentation in multiple formats including standard Javadoc, HTML and Markdown.</p>
</blockquote>

<p>ä½†æ˜¯åˆå¾ˆä¸å¹¸çš„æ˜¯, ç›®å‰ dokka çš„ <code class="highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>dokka-android-gradle-plugin
</pre></td></tr></tbody></table></code> ç›®å‰è¿˜æ²¡æœ‰ release, è€Œä¸” dokka é¡¹ç›®çš„ README
ä¹Ÿéƒ½æ˜¯å‘, è™½ç„¶è¿™ä¸ª Android gradle plugin æ²¡æœ‰ release, ä¸è¿‡ä»–å·²ç»åœ¨ä¸Šé¢å†™ä¸Šç”¨æ³•äº†, ä¹Ÿæ²¡è¯´æ˜æœ‰æ²¡æœ‰ release,
ç›´è‡³æˆ‘åœ¨ bintray ä¸ŠæŸ¥çœ‹äº†ä»–ä»¬çš„ç‰ˆæœ¬æ–‡ä»¶æ‰çŸ¥é“ç¡®å®æ²¡æœ‰è¿™ä¸ª pluginâ€¦., ç„¶åæˆ‘è¯•äº†ä¸€ä¸‹ä½¿ç”¨ <code class="highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>dokka-gradle-plugin
</pre></td></tr></tbody></table></code>,
ä½†æ˜¯æˆ‘ä¹Ÿæ²¡æœ‰å¼„æˆåŠŸ, å¯ä»–çš„ README ä¸Šé¢æ˜æ˜å°±æ˜¯è¿™æ ·å†™çš„</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="n">dokka</span> <span class="o">{</span>
    <span class="n">moduleName</span> <span class="o">=</span> <span class="s1">'data'</span>
    <span class="n">outputFormat</span> <span class="o">=</span> <span class="s1">'javadoc'</span>
    <span class="n">outputDirectory</span> <span class="o">=</span> <span class="s2">"$buildDir/javadoc"</span>
    <span class="n">processConfigurations</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'compile'</span><span class="o">,</span> <span class="s1">'extra'</span><span class="o">]</span>
    <span class="n">includes</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'packages.md'</span><span class="o">,</span> <span class="s1">'extra.md'</span><span class="o">]</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'samples/basic.kt'</span><span class="o">,</span> <span class="s1">'samples/advanced.kt'</span><span class="o">]</span>
    <span class="n">linkMapping</span> <span class="o">{</span>
        <span class="n">dir</span> <span class="o">=</span> <span class="s2">"src/main/kotlin"</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://github.com/cy6erGn0m/vertx3-lang-kotlin/blob/master/src/main/kotlin"</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">"#L"</span>
    <span class="o">}</span>
    <span class="n">sourceDirs</span> <span class="o">=</span> <span class="n">files</span><span class="o">(</span><span class="s1">'src/main/kotlin'</span><span class="o">)</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ä½†æ˜¯ gradle å´æç¤ºæ²¡æœ‰ sourceDirs è¿™ä¸ªå±æ€§, è€Œä¸”å³ä½¿æˆ‘æŠŠå®ƒæ³¨é‡Šæ‰, æœ€ååˆæŠ¥é”™è¯´ linkMapping æ— æ³•å®ä¾‹åŒ–!
ç„¶åæˆ‘åœ¨ä»–çš„æºä»£ç çœ‹, å‘ç°ç¡®å®æ˜¯æ²¡æœ‰ sourceDirs å±æ€§çš„â€¦..</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="n">open</span> <span class="kd">class</span> <span class="nc">DokkaTask</span> <span class="o">:</span> <span class="nc">DefaultTask</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">....</span>
    <span class="nd">@Input</span>
    <span class="kt">var</span> <span class="nl">moduleName:</span> <span class="nc">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="nd">@Input</span>
    <span class="kt">var</span> <span class="nl">outputFormat:</span> <span class="nc">String</span> <span class="o">=</span> <span class="s">"html"</span>
    <span class="kt">var</span> <span class="nl">outputDirectory:</span> <span class="nc">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="nd">@Input</span>
    <span class="kt">var</span> <span class="nl">processConfigurations:</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Any</span><span class="o">?&gt;</span> <span class="o">=</span> <span class="n">arrayListOf</span><span class="o">(</span><span class="s">"compile"</span><span class="o">)</span>
    <span class="nd">@Input</span>
    <span class="kt">var</span> <span class="nl">includes:</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Any</span><span class="o">?&gt;</span> <span class="o">=</span> <span class="n">arrayListOf</span><span class="o">()</span>
    <span class="nd">@Input</span>
    <span class="kt">var</span> <span class="nl">linkMappings:</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">LinkMapping</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">arrayListOf</span><span class="o">()</span>
    <span class="nd">@Input</span>
    <span class="kt">var</span> <span class="nl">samples:</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Any</span><span class="o">?&gt;</span> <span class="o">=</span> <span class="n">arrayListOf</span><span class="o">()</span>
    <span class="nd">@Input</span>
    <span class="kt">var</span> <span class="nl">jdkVersion:</span> <span class="nc">Int</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="n">fun</span> <span class="nf">linkMapping</span><span class="o">(</span><span class="nl">closure:</span> <span class="nc">Closure</span><span class="o">&lt;</span><span class="nc">Any</span><span class="o">?&gt;)</span> <span class="o">{</span>
        <span class="n">val</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nc">LinkMapping</span><span class="o">()</span>
        <span class="n">closure</span><span class="o">.</span><span class="na">delegate</span> <span class="o">=</span> <span class="n">mapping</span>
        <span class="n">closure</span><span class="o">.</span><span class="na">call</span><span class="o">()</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">mapping</span><span class="o">.</span><span class="na">dir</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Link mapping should have dir"</span><span class="o">)</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mapping</span><span class="o">.</span><span class="na">url</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Link mapping should have url"</span><span class="o">)</span>
        <span class="o">}</span>

        <span class="n">linkMappings</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mapping</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="o">....</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æœ€åæ²¡åŠæ³•äº†, åªèƒ½ç”¨å®ƒçš„ <a href="/assets/files/dokka-fatjar.jar">dokka-fatjar.jar</a>
(è¿™ä¸ªæ˜¯æˆ‘ä¸‹è½½ä¸‹æ¥çš„, 0.9.7ç‰ˆæœ¬, å¯ä»¥å» <a href="https://github.com/Kotlin/dokka">Dokka</a>  ä¸‹è½½æœ€æ–°ç‰ˆæœ¬) äº†, è¿™å›ç»ˆäºæ²¡æœ‰è¢«å‘äº†!</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>java <span class="nt">-jar</span> dokka-fatjar.jar &lt;<span class="nb">source </span>directories&gt; &lt;arguments&gt;

Dokka supports the following <span class="nb">command </span>line arguments:

    <span class="nt">-output</span> - the output directory where the documentation is generated
    <span class="nt">-format</span> - the output format:
        html - HTML <span class="o">(</span>default<span class="o">)</span>
        markdown - Markdown
        jekyll - Markdown adapted <span class="k">for </span>Jekyll sites
        javadoc - Javadoc <span class="o">(</span>showing how the project can be accessed from Java<span class="o">)</span>
    <span class="nt">-classpath</span> - list of directories or .jar files to include <span class="k">in </span>the classpath <span class="o">(</span>used <span class="k">for </span>resolving references<span class="o">)</span>
    <span class="nt">-samples</span> - list of directories containing sample code <span class="o">(</span>documentation <span class="k">for </span>those directories is not generated but declarations from them can be referenced using the @sample tag<span class="o">)</span>
    <span class="nt">-module</span> - the name of the module being documented <span class="o">(</span>used as the root directory of the generated documentation<span class="o">)</span>
    <span class="nt">-include</span> - names of files containing the documentation <span class="k">for </span>the module and individual packages
    <span class="nt">-nodeprecated</span> - <span class="k">if </span><span class="nb">set</span>, deprecated elements are not included <span class="k">in </span>the generated documentation
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ä¸è¿‡è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹, å½“ç”Ÿæˆçš„æ ¼å¼ä¸º javadoc æ—¶, dokka-fatjar.jar æœ‰å¼•ç”¨åˆ° <code class="highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>com.sun.javadoc
</pre></td></tr></tbody></table></code> åŒ…,
è¿™ä¸ªåŒ…åœ¨ <code class="highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>jdkX.X.X/lib/tools.jar
</pre></td></tr></tbody></table></code> é‡Œé¢, æ‰€ä»¥å¦‚æœä½ çš„ java CLASS_PATH æ²¡æœ‰æŠŠè¿™ä¸ªè·¯å¾„åŒ…å«è¿›æ¥çš„è¯,
éœ€è¦ä½ æ‰‹åŠ¨æŠŠè¿™ä¸ªè·¯å¾„åŒ…å«è¿›æ¥, å¦åˆ™å°±ä¼šæŠ¥è¿™ä¸ªå¼‚å¸¸</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nc">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ClassNotFoundException</span><span class="o">:</span> <span class="n">com</span><span class="o">.</span><span class="na">sun</span><span class="o">.</span><span class="na">javadoc</span><span class="o">.</span><span class="na">DocErrorReporter</span>
        <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">URLClassLoader</span><span class="o">.</span><span class="na">findClass</span><span class="o">(</span><span class="nc">Unknown</span> <span class="nc">Source</span><span class="o">)</span>
        <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ClassLoader</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="nc">Unknown</span> <span class="nc">Source</span><span class="o">)</span>
        <span class="n">at</span> <span class="n">sun</span><span class="o">.</span><span class="na">misc</span><span class="o">.</span><span class="na">Launcher</span><span class="n">$AppClassLoader</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="nc">Unknown</span> <span class="nc">Source</span><span class="o">)</span>
        <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ClassLoader</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="nc">Unknown</span> <span class="nc">Source</span><span class="o">)</span>
        <span class="o">...</span> <span class="mi">17</span> <span class="n">more</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æˆ‘æ˜¯å°† tools.jar ç›´æ¥æ‹·è´åˆ°äº†å½“å‰ç›®å½•ä¸‹, æ‰€ä»¥æœ€åæˆ‘çš„è¿™ä¸ªå‘½ä»¤ä¸º</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>java <span class="nt">-Djava</span>.ext.dirs<span class="o">=</span><span class="nb">.</span> <span class="nt">-jar</span> dokka-fatjar.jar exrecyclerview/src/main/kotlin/ <span class="nt">-format</span> javadoc <span class="nt">-output</span> exrecyclerview/build/doc
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å½“è¿™ä¸ªå‘½ä»¤æˆåŠŸç”Ÿæˆäº† javadoc æ–‡æ¡£ä¹‹å, æˆ‘å°±æƒ³æ—¢ç„¶å‘½ä»¤èƒ½æˆåŠŸç”Ÿæˆ, é‚£ç”¨ gradle æ¥æ‰§è¡Œè¿™æ¡å‘½ä»¤ä¹Ÿæ˜¯å¯ä»¥çš„,
æœ€åå†ç”¨ gradle æ‰“åŒ…å‘å¸ƒè‡³ bintray ä¸Š å²‚ä¸æ˜¯æ›´æ–¹ä¾¿äº›.</p>

<p>æ‰€ä»¥æˆ‘å°†åŸæ¥å‘å¸ƒ java åº“çš„gradle æ–‡ä»¶æ”¹é€ äº†ä¸€ä¸‹</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
</pre></td><td class="rouge-code"><pre><span class="n">group</span> <span class="o">=</span> <span class="n">PROJ_GROUP</span>
<span class="n">version</span> <span class="o">=</span> <span class="n">PROJ_VERSION</span>
<span class="n">project</span><span class="o">.</span><span class="na">archivesBaseName</span> <span class="o">=</span> <span class="n">PROJ_ARTIFACTID</span>

<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'com.jfrog.bintray'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s2">"com.jfrog.artifactory"</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'maven-publish'</span>


<span class="cm">/**
 * è¿™ä¸ªå°±æ˜¯æ‰§è¡Œå‘½ä»¤çš„ä»»åŠ¡
 */</span>
<span class="c1">//"java -Djava.ext.dirs=. -jar dokka-fatjar.jar exrecyclerview/src/main/kotlin/ -format javadoc -output exrecyclerview/build/doc"</span>
<span class="n">task</span> <span class="nf">dokkaJavadoc</span><span class="o">(</span><span class="nl">type:</span> <span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">Exec</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">workingDir</span> <span class="s1">'.'</span>
    <span class="n">println</span> <span class="s2">"WorkingDir: $workingDir"</span>
    <span class="n">ext</span><span class="o">.</span><span class="na">toolJarPath</span> <span class="o">=</span> <span class="s2">"$workingDir"</span>
    <span class="n">ext</span><span class="o">.</span><span class="na">dokkaJarPath</span> <span class="o">=</span> <span class="s2">"$workingDir"</span><span class="o">+</span><span class="n">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s2">"dokka-fatjar.jar"</span>
    <span class="n">ext</span><span class="o">.</span><span class="na">sourceDirs</span> <span class="o">=</span> <span class="s2">"$workingDir"</span><span class="o">+</span><span class="n">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s2">"src"</span><span class="o">+</span><span class="n">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span><span class="s2">"main"</span>
    <span class="n">ext</span><span class="o">.</span><span class="na">outputFormat</span> <span class="o">=</span> <span class="s1">'javadoc'</span>
    <span class="n">ext</span><span class="o">.</span><span class="na">outputDirectory</span> <span class="o">=</span> <span class="s2">"$buildDir"</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span><span class="o">+</span> <span class="s2">"javadoc"</span>

    <span class="cm">/**
     *
     * è¿™é‡Œè¾“å‡ºæ ¼å¼å¯ä»¥ä¸º: html , markdown, jekyll, javadoc
     * å¦‚æœæ˜¯ javadoc æ ¼å¼, ä»–ä¼šç”¨åˆ° javadoc çš„åº“,
     * å¦‚æœä½ çš„ PATH æ²¡æœ‰åŒ…å« JDK x.x.x/lib è·¯å¾„çš„è¯, å°±ä¼šæŠ¥ 'java.lang.ClassNotFoundException: com.sun.javadoc.DocErrorReporter' å¼‚å¸¸
     * æ‰€ä»¥éœ€è¦ä½ ä¸»åŠ¨å°†è¿™ä¸ªè·¯å¾„åŠ è¿›æ¥, æˆ–è€…å°† JDK x.x.x/lib/tools.jar æ–‡ä»¶æ‹·è´å‡ºæ¥, ä¸‹é¢è¿™ä¸ªå‘½ä»¤æˆ‘å°±æ˜¯æ‹·è´åˆ°äº†å½“å‰ç›®å½•
     *
     * dokka-fatjar.jar è¿™ä¸ªjarå°±æ˜¯ä» dokka é¡¹ç›®ä¸Šä¸‹è½½ä¸‹æ¥çš„
     */</span>
    <span class="n">commandLine</span> <span class="s2">"cmd"</span> <span class="o">,</span> <span class="s2">"/c"</span><span class="o">,</span> <span class="s2">"java -Djava.ext.dirs=$toolJarPath -jar $dokkaJarPath $sourceDirs -format $outputFormat -output $outputDirectory"</span>

    <span class="cm">/**
     * å¦‚æœä½ æ˜¯ Linux ç³»ç»Ÿ, å°±ç”¨è¿™ä¸ª
     */</span>
<span class="c1">//    commandLine "java -Djava.ext.dirs=$toolJarPath -jar $dokkaJarPath $sourceDirs -format $outputFormat -output $outputDirectory"</span>

<span class="o">}</span>

<span class="cm">/**
 * è¿™é‡Œå°†ç”Ÿæˆçš„æ–‡æ¡£æ‰“åŒ…æˆ xxxx-javadoc.jar
 */</span>
<span class="n">task</span> <span class="nf">kotlinDocJar</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Jar</span><span class="o">,</span> <span class="nl">dependsOn:</span> <span class="n">dokkaJavadoc</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="s1">'javadoc'</span>
    <span class="n">from</span> <span class="n">dokkaJavadoc</span><span class="o">.</span><span class="na">outputDirectory</span>
<span class="o">}</span>

<span class="cm">/**
 * è¿™é‡Œå°†æºç æ‰“åŒ…æˆ xxx-sources.jar
 */</span>
<span class="n">task</span> <span class="nf">sourceJar</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Jar</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">classifier</span> <span class="s2">"sources"</span>
    <span class="n">from</span> <span class="n">android</span><span class="o">.</span><span class="na">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">java</span><span class="o">.</span><span class="na">srcDirs</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="n">pomConfig</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">licenses</span> <span class="o">{</span>
        <span class="cm">/**
         * è¿™ä¸ªLicense å¯ä»¥è‡ªè¡Œä¿®æ”¹
         */</span>
        <span class="n">license</span> <span class="o">{</span>
            <span class="n">name</span> <span class="s2">"The Apache Software License, Version 2.0"</span>
            <span class="n">url</span> <span class="s2">"http://www.apache.org/licenses/LICENSE-2.0.txt"</span>
            <span class="n">distribution</span> <span class="s2">"repo"</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">developers</span> <span class="o">{</span>
        <span class="n">developer</span> <span class="o">{</span>
            <span class="n">id</span> <span class="n">DEVELOPER_ID</span>
            <span class="n">name</span> <span class="n">DEVELOPER_NAME</span>
            <span class="n">email</span> <span class="n">DEVELOPER_EMAIL</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">publishing</span> <span class="o">{</span>
    <span class="n">publications</span> <span class="o">{</span>
        <span class="n">mavenKotlin</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">artifact</span> <span class="n">kotlinDocJar</span>

            <span class="n">artifact</span> <span class="n">sourceJar</span>

            <span class="n">pom</span><span class="o">.</span><span class="na">withXml</span> <span class="o">{</span>
                <span class="kt">def</span> <span class="n">root</span> <span class="o">=</span> <span class="n">asNode</span><span class="o">()</span>
                <span class="n">root</span><span class="o">.</span><span class="na">appendNode</span><span class="o">(</span><span class="s1">'description'</span><span class="o">,</span> <span class="n">PROJ_DESCRIPTION</span><span class="o">)</span>
                <span class="n">root</span><span class="o">.</span><span class="na">children</span><span class="o">().</span><span class="na">last</span><span class="o">()</span> <span class="o">+</span> <span class="n">pomConfig</span>

                <span class="kt">def</span> <span class="n">dependenciesNode</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">appendNode</span><span class="o">(</span><span class="s1">'dependencies'</span><span class="o">)</span>
                <span class="n">configurations</span><span class="o">.</span><span class="na">compile</span><span class="o">.</span><span class="na">allDependencies</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">group</span> <span class="o">&amp;&amp;</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span> <span class="o">&amp;&amp;</span> <span class="n">it</span><span class="o">.</span><span class="na">version</span><span class="o">)</span> <span class="o">{</span>
                        <span class="kt">def</span> <span class="n">dependencyNode</span> <span class="o">=</span> <span class="n">dependenciesNode</span><span class="o">.</span><span class="na">appendNode</span><span class="o">(</span><span class="s1">'dependency'</span><span class="o">)</span>
                        <span class="n">dependencyNode</span><span class="o">.</span><span class="na">appendNode</span><span class="o">(</span><span class="s1">'groupId'</span><span class="o">,</span> <span class="n">it</span><span class="o">.</span><span class="na">group</span><span class="o">)</span>
                        <span class="n">dependencyNode</span><span class="o">.</span><span class="na">appendNode</span><span class="o">(</span><span class="s1">'artifactId'</span><span class="o">,</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span><span class="o">)</span>
                        <span class="n">dependencyNode</span><span class="o">.</span><span class="na">appendNode</span><span class="o">(</span><span class="s1">'version'</span><span class="o">,</span> <span class="n">it</span><span class="o">.</span><span class="na">version</span><span class="o">)</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">afterEvaluate</span> <span class="o">{</span>
    <span class="n">publishing</span><span class="o">.</span><span class="na">publications</span><span class="o">.</span><span class="na">mavenKotlin</span><span class="o">.</span><span class="na">artifact</span><span class="o">(</span><span class="n">bundleRelease</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">bintray</span> <span class="o">{</span>
    <span class="n">Properties</span> <span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">()</span>
    <span class="n">properties</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">rootProject</span><span class="o">.</span><span class="na">file</span><span class="o">(</span><span class="s1">'local.properties'</span><span class="o">).</span><span class="na">newDataInputStream</span><span class="o">())</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s2">"bintray.user"</span><span class="o">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s2">"bintray.apikey"</span><span class="o">)</span>

    <span class="n">publications</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'mavenKotlin'</span><span class="o">]</span>
    <span class="n">publish</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="n">pkg</span> <span class="o">{</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="s1">'maven'</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">PROJ_NAME</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">PROJ_DESCRIPTION</span>
        <span class="n">websiteUrl</span> <span class="o">=</span> <span class="n">PROJ_WEBSITEURL</span>
        <span class="n">issueTrackerUrl</span> <span class="o">=</span> <span class="n">PROJ_ISSUETRACKERURL</span>
        <span class="n">vcsUrl</span> <span class="o">=</span> <span class="n">PROJ_VCSURL</span>
        <span class="n">licenses</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'Apache-2.0'</span><span class="o">]</span>
        <span class="n">publicDownloadNumbers</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="n">artifactory</span> <span class="o">{</span>
    <span class="n">contextUrl</span> <span class="o">=</span> <span class="s1">'http://oss.jfrog.org/artifactory'</span>
    <span class="n">resolve</span> <span class="o">{</span>
        <span class="n">repository</span> <span class="o">{</span>
            <span class="n">repoKey</span> <span class="o">=</span> <span class="s1">'libs-release'</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">publish</span> <span class="o">{</span>
        <span class="n">repository</span> <span class="o">{</span>
            <span class="n">repoKey</span> <span class="o">=</span> <span class="s1">'oss-snapshot-local'</span> <span class="c1">//The Artifactory repository key to publish to</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">bintray</span><span class="o">.</span><span class="na">user</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">bintray</span><span class="o">.</span><span class="na">key</span>
            <span class="n">maven</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="o">}</span>
        <span class="n">defaults</span> <span class="o">{</span>
            <span class="c1">//è¿™é‡Œçš„åå­—å’Œä¸Šé¢çº¢è‰²çš„åå­—ä¸€è‡´å³å¯ï¼Œä¼šå°†å…¶åŒ…å«çš„è¾“å‡ºä¸Šä¼ åˆ°jfrogä¸Šå»</span>
            <span class="n">publications</span><span class="o">(</span><span class="s1">'mavenKotlin'</span><span class="o">)</span>
            <span class="n">publishArtifacts</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æœ€åæˆ‘æˆåŠŸäº†ï¼ æˆåŠŸç”Ÿæˆäº† xxx-sources.jar, xxxx-javadoc.jar</p>

<p>ç‚¹å‡» <code class="highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>publishMavenKotlinPublicationMavenLocal
</pre></td></tr></tbody></table></code> ä»»åŠ¡, build æˆåŠŸ, å†æ‰§è¡Œ <code class="highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>bintrayUpload
</pre></td></tr></tbody></table></code> ä»»åŠ¡
æˆåŠŸå°†é¡¹ç›®åº“å‘ä¸Šä¼ åˆ°äº† jfrog bintray!</p>

<h1 id="tips">Tips</h1>

<p>åœ¨è§£å†³é—®é¢˜è¿‡ç¨‹ä¸­çš„å°çŸ¥è¯†ç‚¹, è®°å½•ä¸€ä¸‹</p>

<ul>
  <li>
    <p>cmdå‘½ä»¤è¡Œæ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬è¦è¿è¡Œä¸€ä¸ªjavaç±»ï¼Œä¸€èˆ¬çš„æ–¹æ³•æ˜¯ï¼š</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  java -classpath xxx.jar Test  
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p>å¼•ç”¨å¤šä¸ª jar æ–‡ä»¶</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  java -Djava.ext.dirs=./lib Test
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>gradle è¿è¡Œå¤–éƒ¨å‘½ä»¤</p>

    <div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * æ³¨æ„windows å’Œ linux çš„è·¯å¾„åˆ†éš”ç¬¦çš„ä¸åŒ
 */</span>
<span class="n">task</span> <span class="nf">execCommand</span><span class="o">(</span><span class="nl">type:</span><span class="n">Exec</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">workingDir</span> <span class="s1">'./build'</span>

  <span class="c1">//on windows:</span>
  <span class="n">commandLine</span> <span class="s1">'cmd'</span><span class="o">,</span> <span class="s1">'/c'</span><span class="o">,</span> <span class="s1">'stop.bat'</span>

  <span class="c1">//on linux</span>
  <span class="n">commandLine</span> <span class="s1">'./stop.sh'</span>

  <span class="c1">//store the output instead of printing to the console:</span>
  <span class="n">standardOutput</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">()</span>

  <span class="c1">//extension method stopTomcat.output() can be used to obtain the output:</span>
  <span class="n">ext</span><span class="o">.</span><span class="na">output</span> <span class="o">=</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">standardOutput</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ul>
:ET